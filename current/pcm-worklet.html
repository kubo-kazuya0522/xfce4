<!DOCTYPE html>
<html>
<body>
<h2>PCM streaming (AudioWorklet 最速版)</h2>
<button id="start">再生開始</button>
<p>遅延は 0.8〜1.3 秒を目指します。</p>

<script>
let audioCtx;
let ws;

document.getElementById("start").onclick = async () => {
  audioCtx = new AudioContext({
    sampleRate: 44100,
    latencyHint: "interactive"
  });

  await audioCtx.audioWorklet.addModule("worklet.js");

  const workletNode = new AudioWorkletNode(audioCtx, "pcm-player");
  workletNode.connect(audioCtx.destination);

  ws = new WebSocket(location.origin.replace("https", "wss") + "/pcm-ws");
  ws.binaryType = "arraybuffer";

  ws.onmessage = (event) => {
    workletNode.port.postMessage(event.data);
  };
};
</script>
</body>
</html>
